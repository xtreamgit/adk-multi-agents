#
# Vertex Service Account
# Hector - this is the Vertex AI account creation command I used to troubleshoot the 
# command to create the service account
# Keep this file just in case the RAG Agent fails to access the bucket with information.




PROJECT_NUMBER=$(gcloud projects describe "$PROJECT_ID" --format="value(projectNumber)")
adk-rag-tt $ RAG_SA="service-${PROJECT_NUMBER}@gcp-sa-vertex-rag.iam.gserviceaccount.com"
adk-rag-tt $ echo "$RAG_SA"
service-259141441339@gcp-sa-vertex-rag.iam.gserviceaccount.com
adk-rag-tt $ BUCKET="tt-rag-books"
adk-rag-tt $ gcloud storage buckets add-iam-policy-binding "gs://${BUCKET}" \
  --member="serviceAccount:${RAG_SA}" \
  --role="roles/storage.objectViewer" \
  --project="$PROJECT_ID"
bindings:
- members:
  - projectEditor:adk-rag-tt
  - projectOwner:adk-rag-tt
  role: roles/storage.legacyBucketOwner
- members:
  - projectViewer:adk-rag-tt
  role: roles/storage.legacyBucketReader
- members:
  - projectEditor:adk-rag-tt
  - projectOwner:adk-rag-tt
  role: roles/storage.legacyObjectOwner
- members:
  - projectViewer:adk-rag-tt
  role: roles/storage.legacyObjectReader
- members:
  - serviceAccount:service-259141441339@gcp-sa-vertex-rag.iam.gserviceaccount.com
  role: roles/storage.objectViewer
etag: CAI=
kind: storage#policy
resourceId: projects/_/buckets/tt-rag-books
version: 1
adk-rag-tt $ gcloud storage buckets get-iam-policy "gs://${BUCKET}" --project="$PROJECT_ID" \
  --format="flattened(bindings[].members)" | grep -E "${RAG_SA}|roles/storage.objectViewer" -A1
bindings[4].members[0]: serviceAccount:service-259141441339@gcp-sa-vertex-rag.iam.gserviceaccount.com